<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>购物车</title>
		<link rel="stylesheet" type="text/css" href="css/jianshuan.css"/>
	</head>
	<body>
		<!--顶部-->
		<div id="heard">
			<div id="banxin">
				<div id="heard-left">
					<a href="#" class="kj"></a>
					<a href="#" class="wx"></a>
					<a href="#" class="xl"></a>
				</div>
				<div id="heard-right">
					<ul>
						<li id="yhm">您好，欢迎来到天虹！</li>
						<li><a href="#" id="dlaj" >[登录]</a></li>
						<li><a href="#" id="zcaj">[注册]</a></li>
						<li ></li>
						<li><a href="#">我的订单</a></li>
						<li ></li>
						<li><a href="#">我的天虹</a></li>
						<li ></li>
						<li>
							<div id="">
								客户服务
								<div class="jt"></div>
								<ul class="fw">
									<li><a href="#">大客户服务</a></li>
									<li><a href="#">线上客服</a></li>
									<li><a href="#">服务热线</a></li>
								</ul>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!--顶部结束-->
		<div style="background: #FFFFFF;">
			<div id="banxin">
					<div id="banxin1">
						
					<!--广告-->
					<!--<div id="ggtiao">
						<a href="#"><img src="images/ggt.png"/></a>
						<a href="#" class="gggb"></a>
					</div>-->
					<!--广告-->
					<div id="logok">
						<div class="logo"><a href="index.html"><img src="images/logo_hlj.png"/></a></div>
						<div class="logoright">
							<ul>
								<li class="currr">1.我的购物车<span></span></li>
								<li>2.填写核对订单信息<span></span></li>
								<li>3.成功提交订单<span></span></li>
							</ul>
						</div>
						
					</div>
				</div>
				<!--导航栏结束-->
				<div style="height: 22px;"></div>
				
				
				<!--购物车框架-->
				<div class="gwctop-1">
					<div class="gwctop">
					<div class="gwctop1">运费说明</div>
					<div class="gwctop2">自营商品满额可享受运费优惠，深圳市自提实付满66元免运费；商家自配送商品以商家运费规则为准。详见<a href="http://www.tianhong.cn/help/detail-653.html">配送运费标准</a></div>
					</div>
					<!--商品板块-->
					<div class="gwcsp" style="margin-top: 8px;">
						<div class="gwcsptop">
							<div class="quanxuan">
								<div class="quanxuan1">
									<input type="checkbox" name="quanxuan" id="quanxuan" value="" checked="checked"/>全选
								</div>
								<div class="quanxuan1-1" style="width: 340px;float: left;text-align: center;font-weight: 200;color: #444444;">商品信息</div>
								<div class="quanxuan1-1" style="width: 100px;float: left;text-align: center;font-weight: 200;color: #444444;">价格/积分</div>
								<div class="quanxuan1-1" style="width: 85px;float: left;text-align: center;font-weight: 200;color: #444444;">数量</div>
								<div class="quanxuan1-1" style="width: 100px;float: left;text-align: center;font-weight: 200;color: #444444;">返回积分</div>
								<div class="quanxuan1-1" style="width: 90px;float: left;text-align: center;font-weight: 200;color: #444444;">重量</div>
								<div class="quanxuan1-1" style="width: 100px;float: left;text-align: center;font-weight: 200;color: #444444;">小计</div>
								<div class="quanxuan1-1" style="width: 120px;float: left;text-align: center;font-weight: 200;color: #444444;">操作</div>
							</div>
						</div>
						<!--商品信息模块-->
						<div id="gwc">
							<!--<div id="spxx" style="border: 1px solid #DDDDDD;">
								<div id="spxxxz">
									<input type="checkbox" name="dxxz" id="dxxz" value=""checked="checked" />
								</div>
								<div id="spxxxz1">
									<div id="spxxxz1-1">
										<a href="#"><img src="images/fdjmix1.jpg"/></a>
									</div>
									<div id="spxxxz1-2">
										<a href="#">【花果山】佳沛新西兰阳光金奇异果王22粒原箱装 进口猕猴桃 单果147-175g</a>
										<img src="images/quan_gray.gif"/>
									</div>
								</div>
								<div id="spxxxz2">
									<del>￥ 278.00</del>
									<span>￥ 228.00</span>
								</div>
								<div id="spxxxz3">
									<a href="#" id="sll"></a>
									<span>1</span>
									<a href="#" id="slr"></a>
								</div>
								<div id="spxxxz4">45.6</div>
								<div id="spxxxz5">3.300kg</div>
								<div id="spxxxz6">￥ 228.00</div>
								<div id="spxxxz7"><a href="#">删除</a></div>
							</div>-->
						</div>
						<div class="heji">
							<div class="heji1">
								<div class="heji1-1">
									<input type="checkbox" name="quanxuan" id="" value="" checked="checked"/>全选
									<a href="#" class="blue plsc">批量删除</a>
									<a href="#" class="blue qkgwc">清空购物车</a>
									<a href="#" class="blue1">继续购物</a>
								</div>
								<div class="heji2">
									已选择
									<label class="heji2-1">111</label>
									件商品
									<span>总价（不含运费）<label class="heji2-2">1111</label></span>
								</div>
								<div class="heji3">
									<a href="#"></a>
								</div>
							</div>
						</div>
					</div>
				</div>
				
			</div>
		</div>	
		
		<!--底部服务-->
		
		<div id="banxin">
			<div class="bottomb-2-2">
					<a href="http://www.miibeian.gov.cn/">粤ICP备11065574号-7</a>
					<span>|</span>
					<p> 营业执照　　　Copyright© 天虹 2009-2018, All Rights
        				Reserved　　　天虹商场股份有限公司 版权所有
   	 	</p>
			</div>
			<div class="bottomb-2-3">
				<a href="#"><img height="48" width="40" src="images/wangan2.gif"/></a>
				<a href="#"><img src="images/kexin.gif"/></a>
				<a href="#"><img width="115" height="35" src="images/ylimg.gif"/></a>
				<a href="#"><img src="images/zhongxin.gif"/></a>
				<a href="#"><img width="128" height="46" src="images/newgovicon.gif"/></a>
				<a href="#"><img src="images/wangan.png"/><p>粤公网安备 44030502001023号</p></a>
			</div>
		</div>
		
	</body>
</html>
<script src="../jq/jquery.js" type="text/javascript"></script>
<script src="../public.js" type="text/javascript"></script>
<script src="../ajks.js" type="text/javascript"></script>
<script type="text/javascript">
	window.onload=function(){
		ajax({
		method: "get",
		url: "xqy.php",
		success: function(res) {
			var json = JSON.parse(res);
			var name=localStorage.getItem("yhm"+"Goods");
			var bdjson = JSON.parse(localStorage.getItem(name+"Goods"));
//			var zjg=0;
//			console.log(bdjson)
			sjjz()
			function sjjz(){
			var zjg=0;	
			if(bdjson){
				for(var k = 0; k < json.length; k++) {
				for (var i = 0; i < bdjson.length; i++) {
					if(bdjson[i].bid == json[k].id){
							zjg += json[k].cbrq * bdjson[i].count;
						
						
						
						
						
						
						
						$id("gwc").innerHTML += `<div id="spxx" style="border: 1px solid #DDDDDD;">
								<div id="spxxxz">
									<input type="checkbox" name="dxxz" id="dxxz" value="${bdjson[i].bid}"checked="checked" />
								</div>
								<div id="spxxxz1">
									<div id="spxxxz1-1">
										<a href="#"><img src="${json[k].img}"/></a>
									</div>
									<div id="spxxxz1-2">
										<a href="#">${json[k].uname}</a>
									</div>
								</div>
								<div id="spxxxz2">
									<del>￥ ${json[k].cbs}</del>
									<span>￥${json[k].cbrq}</span>
								</div>
								<div id="spxxxz3">
									<a href="javascript:void(0);" id="sll"><input type="hidden" name="" id="" value="${bdjson[i].bid}" /></a>
									<span>${bdjson[i].count}</span>
									<a href="javascript:void(0);" id="slr"><input type="hidden" name="" id="" value="${bdjson[i].bid}" /></a>
								</div>
								<div id="spxxxz4">${(json[k].price * bdjson[i].count).toFixed(2)}</div>
								<div id="spxxxz5">${json[k].kg}</div>
								<div id="spxxxz6">${json[k].cbrq * bdjson[i].count}</div>
								<div id="spxxxz7"><a href="javascript:void(0);" id="dide">删除<input type="hidden" name="" id="" value="${bdjson[i].bid}" /></a></div>
							</div>`;
					}
				}
				$(".heji2-2").html(zjg)
			}
			}
			
			
			zs()//计算总数
			
			
			$("#gwc>#spxx>#spxxxz3>#slr").click(function(e){
			var zj = $(this).find("input").val();
			var san = 0;
	//		console.log(top);
				for (var i = 0; i < bdjson.length; i++) {
					if(bdjson[i].bid == zj){
						bdjson[i].count++;
						san=bdjson[i].count;
					}
				}
//				console.log(bdjson)
				var name=localStorage.getItem("yhm"+"Goods");
				var nullGoodss = JSON.stringify(bdjson);
				localStorage.setItem(name+"Goods",nullGoodss);
//				$id("gwc").innerHTML="";
//				sjjz();
				zs();
				zje();
				sjxg();
				$(this).prev().html(san);
//				$(this).parent()
//				setTimeout(function(){
//					document.documentElement.scrollTop=top;
//					console.log(document.documentElement.scrollTop)
//				})
				
				
			})
			$("#gwc>#spxx>#spxxxz3>#sll").click(function(){
			var zj = $(this).find("input").val();
			var top = document.documentElement.scrollTop;
			var san=0;
				for (var i = 0; i < bdjson.length; i++) {
					if(bdjson[i].bid == zj){
						bdjson[i].count--;
						san = bdjson[i].count;
						if(bdjson[i].count<0){
							bdjson.splice(bdjson.indexOf(bdjson[i]),1);
							$(this).parent().parent('#spxx').remove();
						}
					}
					
				}
//				console.log(bdjson)
				var name=localStorage.getItem("yhm"+"Goods");
				var nullGoodss = JSON.stringify(bdjson);
				localStorage.setItem(name+"Goods",nullGoodss);
				zs();
				zje();
				sjxg()
//				$id("gwc").innerHTML="";
//				sjjz();
				$(this).next().html(san);
			})
			$("a[id=dide]").click(function(){
				var zj = $(this).find("input").val();
				for (var i = 0; i < bdjson.length; i++) {
					if(bdjson[i].bid == zj){
							bdjson.splice(bdjson.indexOf(bdjson[i]),1);
					}
					
				}
				var name=localStorage.getItem("yhm"+"Goods");
				var nullGoodss = JSON.stringify(bdjson);
				localStorage.setItem(name+"Goods",nullGoodss);
//				$id("gwc").innerHTML=""
//				sjjz()
				$(this).parent().parent('#spxx').remove()
//				$("div[id=spxx]").eq($(this).index()+1).remove();
//				$("#spxx").eq($(this).index()+1).remove();
				zs();
				zje();
			})
			
			//全选全不选
			$("input[name=quanxuan]").click(function(){
				zje();
				$("input[name=dxxz]").prop("checked",$(this).prop("checked"));
				$("input[name=quanxuan]").prop("checked",$(this).prop("checked"));
			})
			$("input[name=dxxz]").click(function(){
				var flag = true;
				zs();
				zje()
				$("input[name=dxxz]").each(function(index,item){
					if(!$(item).prop("checked")){
						flag = false;
						return;
					}
				})
				if(flag){
						$("input[name=quanxuan]").prop("checked",true);
					}else{
						$("input[name=quanxuan]").prop("checked",false);
				}
			})
			
			
			//批量删除
			$(".plsc").click(function(){
				for (var i = 0; i < $("input[name=dxxz]").length; i++) {
					if($("input[name=dxxz]").eq(i).prop("checked")){
						for(var j = 0; j < bdjson.length;j++){
						if($("input[name=dxxz]").eq(i).val()==bdjson[j].bid){
							bdjson.splice(bdjson.indexOf(bdjson[i]),1);
							i--;
						}
					}
					}
				}
				var name=localStorage.getItem("yhm"+"Goods");
				var nullGoodss = JSON.stringify(bdjson);
				localStorage.setItem(name+"Goods",nullGoodss);
				$id("gwc").innerHTML="";
//				sjjz();
				zs();
				location.reload();
			})
			$(".qkgwc").click(function(){
				localStorage.removeItem(name+"Goods");
				$id("gwc").innerHTML="";
				location.reload();
				zs();
			})
//			console.log($("div[id=spxxxz6]").eq(1).html())
			zje()
			function zje(){
				var san=0;
				$("input[name=dxxz]").each(function(index,item){
					if($(item).prop("checked")){
						
						san+=parseInt($("div[id=spxxxz6]").eq(index).html());
					}
				})
				$(".heji2-2").html(san);
			}
			
			
			
			
			}
			
			
			
			
			
			
			sjxg()
			function sjxg(){
				var name=localStorage.getItem("yhm"+"Goods");
				var uname1 = JSON.parse(localStorage.getItem(name+"Goods"));
				for(var j = 0 ; j < uname1.length;j++){
					for (var i = 0; i < json.length; i++) {
						if(json[i].id == uname1[j].bid){
							$("div[id=spxxxz4]").eq(j).html((json[i].price * uname1[j].count).toFixed(2));
							$("div[id=spxxxz5]").eq(j).html((json[i].kg.split("kg")[0]*uname1[j].count ).toFixed(3)+"kg");
							$("div[id=spxxxz6]").eq(j).html((json[i].cbrq * uname1[j].count).toFixed(2));
						}
					}
				}
				
			}
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
		}
	})
//		zs()
		function zs(){
			var name=localStorage.getItem("yhm"+"Goods");
			var uname1 = JSON.parse(localStorage.getItem(name+"Goods"));
			var sl=0;
			var san=0
//			console.log(uname1)
			if(uname1){
				for (var i = 0; i < uname1.length; i++) {
				if($("input[name=dxxz]").eq(i).prop("checked")){
					sl+=uname1[i].count;
				}
				
			}
			}
			
			$(".heji2-1").html(sl);
		}
//		
//		function zj(json){
//			for (var i = 0; i < Things.length; i++) {
//				Things[i]
//			}
//		}
	}
	

	
	
	
	
	
	
	
	
	
	
		$(".jiesuan").click(function(){
		location.href = "jieshuan.html"
	})
	
	
	
	
var cartGoods = localStorage.getItem("yhm"+"Goods");
	if(cartGoods){
		$("#dlaj").hide();
		$("#zcaj").html("[退出]");
		$("#yhm").html(`您好${cartGoods}，欢迎来到天虹！`);
	}else{
		$("#dlaj").show();
		$("#zcaj").html("[注册]");
		$("#yhm").html("您好，欢迎来到天虹！");
	}
	$("#zcaj").click(function(){
		if($("#zcaj").html()=="[退出]"){
			localStorage.removeItem('yhmGoods');
			location.reload();
		}else{
			location.href="../denglv/zc.html";
		}
	})
	$("#dlaj").click(function(){
		location.href = "../denglv/dl.html";
	})
	
	
//	$(".heji1").scroll(function(){
//		
//	})
//	$(document).scroll(function(e){
//		var top = $(".heji1").offset().top;
//		var t = document.body.offsetHeight-$(".heji1").height();
//		if(t>=top){
//			$(".heji1").css("position","fixed");
//		}else{
//			$(".heji1").css("position","absolute");
//		}
//		console.log($(".heji1").height())
//		console.log(top,t)
//	})



</script>